---
- hosts: localhost
  connection: local
  vars:
    avi_credentials:
      controller: "{{ lookup('env', 'AVI_CONTROLLER') }}"
      username: "{{ lookup('env', 'AVI_USERNAME') }}"
      password: "{{ lookup('env', 'AVI_PASSWORD') }}"
      api_version: "{{ lookup('env', 'API_VERSION') }}"
      state: "{{ state }}"

  roles:
    - role: avinetworks.aviconfig
  tasks:
    - name: AVI Alertconfig | Create Alertconfig object
      avi_alertconfig:
        controller: "{{avi_credentials.controller}}"
        username: "{{avi_credentials.username}}"
        password: "{{avi_credentials.password}}"
        api_version: "{{avi_credentials.api_version}}"
        state: "{{avi_credentials.state}}"
        name: test-profile
        enabled: true
        tenant_ref: "/api/tenant/?name=admin"
        category: REALTIME
        expiry_time: 86400
        summary: System-SSL-Alert System Alert Triggered
        rolling_window: 300
        source: EVENT_LOGS
        alert_rule:
          operator: OPERATOR_OR
          sys_event_rule:
          - event_id: SSL_CERT_EXPIRE
            not_cond: false
          - event_id: SSL_CERT_RENEW
            not_cond: false
          - event_id: SSL_CERT_RENEW_FAILED
            not_cond: false
          threshold: 1
          throttle: 0
          action_group_ref: "/api/actiongroupconfig/?name=System-Alert-Level-Medium"