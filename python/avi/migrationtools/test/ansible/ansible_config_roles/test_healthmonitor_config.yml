# This is playbook for healthmonitor.
#
---
- hosts: localhost
  connection: local
  vars:
    avi_credentials:
      controller: "{{ lookup('env', 'AVI_CONTROLLER') }}"
      username: "{{ lookup('env', 'AVI_USERNAME') }}"
      password: "{{ lookup('env', 'AVI_PASSWORD') }}"
      api_version: "{{ lookup('env', 'API_VERSION') }}"
      state: "{{ state }}"
    
  roles:
    - role: avinetworks.aviconfig
  tasks:
    - name: AVI Healthmonitor | Create HealthMonitor
      avi_healthmonitor:
        controller: "{{avi_credentials.controller}}"
        username: "{{avi_credentials.username}}"
        password: "{{avi_credentials.password}}"
        api_version: "{{avi_credentials.api_version}}"
        state: "{{avi_credentials.state}}"
        name: "test-healthmonitor"
        receive_timeout: 1
        monitor_port: 18000
        failed_checks: 3
        send_interval: 2
        successful_checks: 1
        type: HEALTH_MONITOR_HTTP
